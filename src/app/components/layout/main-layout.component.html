<div class="min-h-screen flex flex-col bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
  <!-- Header -->
  <header
    class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-50 transition-colors duration-300">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative">
      <div class="flex items-center justify-between h-16">

        <!-- SECCIÓN IZQUIERDA -->
        <div class="flex items-center justify-start w-1/4">
          <!-- Mobile: Menú Hamburguesa (Solo logueado) -->
          <button *ngIf="isAuthenticated" (click)="toggleSidebar()"
            class="lg:hidden p-2 rounded-md text-[#08d15f] hover:bg-green-50 dark:hover:bg-green-900/20 focus:outline-none transition-colors">
            <i class="pi pi-bars text-2xl"></i>
          </button>

          <!-- Desktop: Logo (Visible en LG+) -->
          <div class="hidden lg:flex items-center">
            <a [routerLink]="getHomeRoute()" class="cursor-pointer">
              <img [src]="logoPath" alt="SBENIX Logo" class="h-10 transition-all duration-300">
            </a>
          </div>
        </div>

        <!-- SECCIÓN CENTRO -->
        <div class="flex items-center justify-center w-2/4">
          <!-- Mobile: Logo (Centrado en < LG) -->
          <div class="lg:hidden flex justify-center w-full">
            <a [routerLink]="getHomeRoute()" class="cursor-pointer">
              <img [src]="logoPath" alt="SBENIX Logo" class="h-8 transition-all duration-300">
            </a>
          </div>

          <!-- Desktop: Menú Central (Iconos) - Solo si está autenticado -->
          <nav *ngIf="isAuthenticated" class="hidden lg:flex items-center gap-6">
            <a routerLink="/" routerLinkActive="text-[#08d15f] bg-green-50 dark:bg-green-900/20"
              [routerLinkActiveOptions]="{exact: true}"
              class="p-2 rounded-full text-[#08d15f] dark:text-[#08d15f] hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
              title="Inicio">
              <i class="pi pi-home text-xl"></i>
            </a>

            <a routerLink="/productos" routerLinkActive="text-[#08d15f] bg-green-50 dark:bg-green-900/20"
              class="p-2 rounded-full text-[#08d15f] dark:text-[#08d15f] hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
              title="Productos">
              <i class="pi pi-box text-xl"></i>
            </a>

            <a [routerLink]="dashboardLink" routerLinkActive="text-[#08d15f] bg-green-50 dark:bg-green-900/20"
              class="p-2 rounded-full text-[#08d15f] dark:text-[#08d15f] hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
              title="Dashboard">
              <i class="pi pi-th-large text-xl"></i>
            </a>

            <a routerLink="/pedidos" routerLinkActive="text-[#08d15f] bg-green-50 dark:bg-green-900/20"
              class="p-2 rounded-full text-[#08d15f] dark:text-[#08d15f] hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
              title="Pedidos">
              <i class="pi pi-shopping-bag text-xl"></i>
            </a>
          </nav>
        </div>

        <!-- SECCIÓN DERECHA: Utilidades -->
        <div class="flex items-center justify-end w-1/4 gap-2">

          <!-- Selector de Idioma (Botón) - Solo si está autenticado -->
          <div *ngIf="isAuthenticated" class="relative group">
            <button (click)="changeLanguage(currentLang === 'ES' ? 'EN' : 'ES')"
              class="p-2 rounded-full text-[#08d15f] dark:text-[#08d15f] hover:bg-green-50 dark:hover:bg-gray-700/50 transition-colors"
              [title]="currentLang === 'ES' ? 'Switch to English' : 'Cambiar a Español'">
              <span class="text-xs font-bold">{{ currentLang }}</span>
            </button>
          </div>

          <!-- Theme Toggle (Branding #08d15f) - Solo si está autenticado -->
          <button *ngIf="isAuthenticated" (click)="toggleTheme()"
            class="p-2 transition-colors text-[#08d15f] dark:text-[#08d15f] hover:bg-green-50 dark:hover:bg-gray-700/50 rounded-full"
            [title]="isDarkMode ? 'Cambiar a modo claro' : 'Cambiar a modo oscuro'">
            <i class="pi text-xl" [ngClass]="{'pi-moon': !isDarkMode, 'pi-sun': isDarkMode}"></i>
          </button>

          <!-- Perfil / Login Icon -->
          <div *ngIf="isAuthenticated" class="relative">
            <button (click)="toggleDrawer()"
              class="h-9 w-9 rounded-full shadow hover:shadow-lg hover:scale-110 transition-all border-2 border-green-100 dark:border-green-900">
              <app-avatar 
                [name]="userName" 
                [photoUrl]="userPhotoUrl" 
                size="small"
                backgroundColor="#08d15f">
              </app-avatar>
            </button>

            <!-- Profile Menu Dropdown -->
            <div *ngIf="isDrawerOpen" (click)="$event.stopPropagation()"
              class="absolute right-0 mt-2 w-72 bg-white dark:bg-gray-800 rounded-lg shadow-xl py-2 z-50 border border-gray-200 dark:border-gray-700">
              
              <!-- User Info Section -->
              <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center gap-3">
                  <app-avatar 
                    [name]="userName" 
                    [photoUrl]="userPhotoUrl" 
                    size="medium"
                    backgroundColor="#08d15f">
                  </app-avatar>
                  <div class="flex-grow min-w-0">
                    <p class="text-xs font-semibold text-[#08d15f] uppercase tracking-wider mb-1">{{ userRole }}</p>
                    <p class="text-sm font-semibold text-gray-900 dark:text-white truncate">{{ userName }}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 truncate">{{ userEmail }}</p>
                  </div>
                </div>
              </div>

              <!-- Account Options -->
              <div class="py-2 border-b border-gray-200 dark:border-gray-700">
                <a routerLink="/profile" (click)="isDrawerOpen = false"
                  class="flex items-center gap-3 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
                  <i class="pi pi-user text-[#08d15f]"></i>
                  <span>{{ 'profile.editProfile' | translate }}</span>
                </a>
                <a routerLink="/account-settings" (click)="isDrawerOpen = false"
                  class="flex items-center gap-3 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
                  <i class="pi pi-cog text-[#08d15f]"></i>
                  <span>{{ 'common.settings' | translate }}</span>
                </a>
              </div>

              <!-- Language & Theme Selector -->
              <div class="py-2 px-4 border-b border-gray-200 dark:border-gray-700">
                <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2">{{ 'common.language' | translate }}</p>
                
                <!-- Language Selector -->
                <div class="mb-3">
                  <div class="flex gap-2">
                    <button (click)="changeLanguage('ES'); isDrawerOpen = false"
                      [ngClass]="{'bg-[#08d15f] text-white': currentLang === 'ES', 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300': currentLang !== 'ES'}"
                      class="flex-1 px-3 py-2 rounded text-xs font-medium transition-colors hover:opacity-80">
                      Español
                    </button>
                    <button (click)="changeLanguage('EN'); isDrawerOpen = false"
                      [ngClass]="{'bg-[#08d15f] text-white': currentLang === 'EN', 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300': currentLang !== 'EN'}"
                      class="flex-1 px-3 py-2 rounded text-xs font-medium transition-colors hover:opacity-80">
                      English
                    </button>
                  </div>
                </div>

                <!-- Theme Toggle -->
                <div>
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2">{{ 'common.theme' | translate }}</p>
                  <div class="flex gap-2">
                    <button (click)="isDarkMode = false; toggleTheme()"
                      [ngClass]="{'bg-[#08d15f] text-white': !isDarkMode, 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300': isDarkMode}"
                      class="flex-1 px-3 py-2 rounded text-xs font-medium transition-colors hover:opacity-80 flex items-center justify-center gap-1">
                      <i class="pi pi-sun text-sm"></i>
                      <span>Claro</span>
                    </button>
                    <button (click)="isDarkMode = true; toggleTheme()"
                      [ngClass]="{'bg-[#08d15f] text-white': isDarkMode, 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300': !isDarkMode}"
                      class="flex-1 px-3 py-2 rounded text-xs font-medium transition-colors hover:opacity-80 flex items-center justify-center gap-1">
                      <i class="pi pi-moon text-sm"></i>
                      <span>Oscuro</span>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Logout Button -->
              <div class="py-2">
                <button (click)="logout()"
                  class="flex items-center gap-3 px-4 py-2 w-full text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/10 transition-colors rounded">
                  <i class="pi pi-sign-out"></i>
                  <span>{{ 'common.logout' | translate }}</span>
                </button>
              </div>

            </div>
          </div>

        </div>
      </div>
    </div>
  </header>

  <!-- Sidebar (Izquierda - Navegación) -->
  <div *ngIf="isAuthenticated">
    <!-- Overlay -->
    <div *ngIf="isSidebarOpen" (click)="toggleSidebar()"
      class="fixed inset-0 bg-black bg-opacity-50 z-40 transition-opacity"></div>

    <!-- Sidebar Panel -->
    <aside
      class="fixed top-0 left-0 h-full w-64 bg-white dark:bg-gray-800 z-50 transform transition-transform duration-300 ease-in-out shadow-2xl"
      [ngClass]="{'translate-x-0': isSidebarOpen, '-translate-x-full': !isSidebarOpen}">

      <div class="flex items-center justify-between p-4 border-b border-gray-100 dark:border-gray-700">
        <h2 class="text-lg font-bold text-gray-800 dark:text-white">{{ 'common.menu' | translate }}</h2>
        <button (click)="toggleSidebar()" class="text-gray-500 hover:text-red-500">
          <i class="pi pi-times text-xl"></i>
        </button>
      </div>

      <nav class="p-4 space-y-2">
        <a routerLink="/" (click)="toggleSidebar()" routerLinkActive="bg-[#08d15f]/10 text-[#08d15f]"
          [routerLinkActiveOptions]="{exact: true}"
          class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
          <i class="pi pi-home"></i> {{ 'nav.home' | translate }}
        </a>

        <a [routerLink]="dashboardLink" (click)="toggleSidebar()" routerLinkActive="bg-[#08d15f]/10 text-[#08d15f]"
          class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
          <i class="pi pi-th-large"></i> {{ 'nav.dashboard' | translate }}
        </a>

        <a routerLink="/productos" (click)="toggleSidebar()" routerLinkActive="bg-[#08d15f]/10 text-[#08d15f]"
          class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
          <i class="pi pi-box"></i> {{ 'nav.products' | translate }}
        </a>

        <a routerLink="/pedidos" (click)="toggleSidebar()" routerLinkActive="bg-[#08d15f]/10 text-[#08d15f]"
          class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
          <i class="pi pi-shopping-bag"></i> {{ 'nav.orders' | translate }}
        </a>

        <a routerLink="/categorias" (click)="toggleSidebar()" routerLinkActive="bg-[#08d15f]/10 text-[#08d15f]"
          class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
          <i class="pi pi-tags"></i> {{ 'nav.categories' | translate }}
        </a>

        <a routerLink="/contacto" (click)="toggleSidebar()" routerLinkActive="bg-[#08d15f]/10 text-[#08d15f]"
          class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
          <i class="pi pi-envelope"></i> {{ 'nav.contact' | translate }}
        </a>
      </nav>

    </aside>
  </div>

  <!-- Contenido principal -->
  <main class="flex-grow max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-8 transition-all duration-300">
    <router-outlet></router-outlet>
  </main>

  <!-- Footer -->
  <footer
    class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 mt-auto transition-colors duration-300">
    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
      <p class="text-center text-gray-500 dark:text-gray-400 text-sm">
        © {{ currentYear }} SBENIX Platform. Todos los derechos reservados.
      </p>
    </div>
  </footer>
</div>